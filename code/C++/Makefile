###############################################################################

CXXFLAGS = -g -march=native -O3 -std=c++11 -Wall

###############################################################################

SRC = $(wildcard *.cc)
EXE = $(basename $(SRC))
PERF = $(EXE:=.perf)
REP = $(EXE:=.rep)
DAT = $(EXE:=.dat)

###############################################################################

default: $(EXE)

all: $(DAT)

clean:
	$(RM) -rf $(EXE) $(PERF) $(DAT) *.perf.old

###############################################################################

%.perf: %
	perf record --call-graph dwarf -o $@ ./$<

%.rep: %.perf
	perf report -i $<

%.dat: %
	./$< | tee $@


###############################################################################

.PHONY: all clean default
.NOEXPORT:

###############################################################################
